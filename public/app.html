<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MoveQuote</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%233b82f6'/%3E%3Cpath d='M8 14h16v12H8z' fill='white'/%3E%3Cpath d='M10 8h12v8H10z' fill='white' opacity='.8'/%3E%3Crect x='12' y='18' width='3' height='4' fill='%233b82f6'/%3E%3Crect x='17' y='18' width='3' height='4' fill='%233b82f6'/%3E%3C/svg%3E">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #dbeafe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --green-500: #10b981;
            --red-500: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-50);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid var(--gray-200);
            padding: 1.5rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1rem;
        }

        .logo-sidebar {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-sidebar svg {
            width: 28px;
            height: 28px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .nav-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            border-right: 3px solid var(--primary);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 2rem;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .welcome-text h1 {
            font-size: 1.875rem;
            margin-bottom: 0.25rem;
        }

        .welcome-text p {
            color: var(--gray-600);
        }

        .top-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--gray-200);
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            color: var(--green-500);
        }

        /* Quote Form */
        .quote-form {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }

        .quote-form h2 {
            margin-bottom: 1.5rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .checkbox-group input {
            width: auto;
        }

        /* Quotes List */
        .quotes-list {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--gray-200);
            overflow: hidden;
        }

        .quotes-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quotes-header h2 {
            margin: 0;
        }

        .quotes-table {
            width: 100%;
            border-collapse: collapse;
        }

        .quotes-table th {
            text-align: left;
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .quotes-table td {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
        }

        .quotes-table tr:hover {
            background: var(--gray-50);
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending {
            background: var(--primary-light);
            color: var(--primary-dark);
        }

        .status-accepted {
            background: #d1fae5;
            color: #059669;
        }

        .empty-state {
            padding: 3rem;
            text-align: center;
            color: var(--gray-500);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--green-500);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(calc(100% + 2rem));
            transition: transform 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--red-500);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray-500);
        }

        .spinner {
            border: 3px solid var(--gray-200);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }

        /* View Sections */
        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
        }

        /* Upgrade Banner */
        .upgrade-banner {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upgrade-banner h3 {
            margin-bottom: 0.25rem;
        }

        .upgrade-banner p {
            opacity: 0.9;
            font-size: 0.875rem;
        }

        .btn-white {
            background: white;
            color: var(--primary);
        }

        .btn-white:hover {
            background: var(--gray-100);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                        <rect width="32" height="32" rx="6" fill="#3b82f6"/>
                        <path d="M8 14h16v12H8z" fill="white"/>
                        <path d="M10 8h12v8H10z" fill="white" opacity=".8"/>
                        <rect x="12" y="18" width="3" height="4" fill="#3b82f6"/>
                        <rect x="17" y="18" width="3" height="4" fill="#3b82f6"/>
                    </svg>
                    MoveQuote
                </div>
            </div>
            <ul class="sidebar-nav">
                <li class="nav-item active" onclick="switchView('dashboard')">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                    Dashboard
                </li>
                <li class="nav-item" onclick="switchView('quotes')">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"/>
                    </svg>
                    All Quotes
                </li>
                <li class="nav-item" onclick="showUpgradeModal()">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"/>
                    </svg>
                    Upgrade to Pro
                </li>
                <li class="nav-item" onclick="logout()">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/>
                    </svg>
                    Sign Out
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="view-dashboard" class="view-section active">
                <div class="top-bar">
                    <div class="welcome-text">
                        <h1>Welcome back, <span id="user-name">User</span>!</h1>
                        <p>Let's create some winning moving quotes today.</p>
                    </div>
                    <div class="top-actions">
                        <button class="btn btn-primary" onclick="scrollToQuoteForm()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            New Quote
                        </button>
                    </div>
                </div>

                <!-- Upgrade Banner (Free users only) -->
                <div id="upgrade-banner" class="upgrade-banner" style="display: none;">
                    <div>
                        <h3>ðŸš€ Upgrade to Pro</h3>
                        <p>Unlimited quotes, custom branding, and priority support for just $29/month</p>
                    </div>
                    <button class="btn btn-white" onclick="showUpgradeModal()">Upgrade Now</button>
                </div>

                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Quotes</div>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-change">All time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">This Month</div>
                        <div class="stat-value" id="stat-month">0</div>
                        <div class="stat-change">+0% from last month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="stat-revenue">$0</div>
                        <div class="stat-change">From accepted quotes</div>
                    </div>
                </div>

                <!-- Quote Form -->
                <div class="quote-form" id="quote-form-section">
                    <h2>Create New Moving Quote</h2>
                    <form id="quote-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="client-name">Client Name *</label>
                                <input type="text" id="client-name" required placeholder="John Smith">
                            </div>
                            <div class="form-group">
                                <label for="client-email">Client Email *</label>
                                <input type="email" id="client-email" required placeholder="john@example.com">
                            </div>
                            <div class="form-group">
                                <label for="origin">Origin Address *</label>
                                <input type="text" id="origin" required placeholder="123 Main St, City, State">
                            </div>
                            <div class="form-group">
                                <label for="destination">Destination Address *</label>
                                <input type="text" id="destination" required placeholder="456 Oak Ave, City, State">
                            </div>
                            <div class="form-group">
                                <label for="move-type">Move Type</label>
                                <select id="move-type">
                                    <option value="local">Local Move (under 50 miles)</option>
                                    <option value="longdistance">Long Distance Move</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="home-size">Home Size</label>
                                <select id="home-size">
                                    <option value="studio">Studio/1 Bedroom</option>
                                    <option value="2bed">2 Bedroom</option>
                                    <option value="3bed">3 Bedroom</option>
                                    <option value="4bed">4+ Bedroom</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="movers">Number of Movers</label>
                                <input type="number" id="movers" min="2" max="10" value="2">
                            </div>
                            <div class="form-group">
                                <label for="hours">Estimated Hours</label>
                                <input type="number" id="hours" min="1" max="24" value="4">
                            </div>
                            <div class="form-group">
                                <label for="truck-size">Truck Size</label>
                                <select id="truck-size">
                                    <option value="small">Small Truck (10-14 ft)</option>
                                    <option value="medium">Medium Truck (16-20 ft)</option>
                                    <option value="large">Large Truck (24-26 ft)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="hourly-rate">Hourly Rate per Mover ($)</label>
                                <input type="number" id="hourly-rate" min="1" value="100">
                            </div>
                            <div class="form-group full-width">
                                <label>Additional Services</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="packing">
                                    <label for="packing" style="margin: 0;">Packing Service (+$200)</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="storage">
                                    <label for="storage" style="margin: 0;">Storage (30 days) (+$150)</label>
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label for="notes">Notes (optional)</label>
                                <textarea id="notes" placeholder="Any special requirements or notes..."></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button type="submit" class="btn btn-primary">Create Quote</button>
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
                        </div>
                    </form>
                </div>

                <!-- Recent Quotes -->
                <div class="quotes-list">
                    <div class="quotes-header">
                        <h2>Recent Quotes</h2>
                        <button class="btn btn-secondary" onclick="switchView('quotes')">View All</button>
                    </div>
                    <div id="recent-quotes-content">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading quotes...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- All Quotes View -->
            <div id="view-quotes" class="view-section">
                <div class="top-bar">
                    <div class="welcome-text">
                        <h1>All Quotes</h1>
                        <p>Manage and track all your moving quotes</p>
                    </div>
                    <div class="top-actions">
                        <button class="btn btn-primary" onclick="switchView('dashboard'); setTimeout(scrollToQuoteForm, 300);">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            New Quote
                        </button>
                    </div>
                </div>

                <div class="quotes-list">
                    <div id="all-quotes-content">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading quotes...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const API_URL = 'https://api-production-e5b3.up.railway.app';
        let currentUser = null;
        let allQuotes = [];

        // ============================================
        // INITIALIZATION
        // ============================================
        async function init() {
            // Check authentication
            const token = localStorage.getItem('mq_token');
            const userStr = localStorage.getItem('mq_user');
            
            if (!token || !userStr) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                currentUser = JSON.parse(userStr);
                document.getElementById('user-name').textContent = currentUser.name || 'User';
                
                // Show upgrade banner for free users
                if (!currentUser.isPro) {
                    document.getElementById('upgrade-banner').style.display = 'flex';
                }
                
                // Load quotes
                await loadQuotes();
            } catch (error) {
                console.error('Init error:', error);
                showToast('Failed to load data', 'error');
            }
        }

        // ============================================
        // QUOTES
        // ============================================
        async function loadQuotes() {
            const token = localStorage.getItem('mq_token');
            
            try {
                const response = await fetch(`${API_URL}/api/quotes`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load quotes');
                }

                const data = await response.json();
                allQuotes = data.quotes || [];
                
                updateStats();
                renderRecentQuotes();
                renderAllQuotes();
            } catch (error) {
                console.error('Load quotes error:', error);
                document.getElementById('recent-quotes-content').innerHTML = '<div class="empty-state">Failed to load quotes</div>';
                document.getElementById('all-quotes-content').innerHTML = '<div class="empty-state">Failed to load quotes</div>';
            }
        }

        function updateStats() {
            const now = new Date();
            const thisMonth = allQuotes.filter(q => {
                const created = new Date(q.createdAt);
                return created.getMonth() === now.getMonth() && created.getFullYear() === now.getFullYear();
            });

            const totalRevenue = allQuotes
                .filter(q => q.status === 'accepted')
                .reduce((sum, q) => sum + (q.total || 0), 0);

            document.getElementById('stat-total').textContent = allQuotes.length;
            document.getElementById('stat-month').textContent = thisMonth.length;
            document.getElementById('stat-revenue').textContent = '$' + totalRevenue.toLocaleString();
        }

        function renderRecentQuotes() {
            const recent = allQuotes.slice(0, 5);
            
            if (recent.length === 0) {
                document.getElementById('recent-quotes-content').innerHTML = `
                    <div class="empty-state">
                        <p>No quotes yet. Create your first moving quote above!</p>
                    </div>
                `;
                return;
            }

            const html = `
                <table class="quotes-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Origin â†’ Destination</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recent.map(q => `
                            <tr>
                                <td><strong>${q.clientName || 'N/A'}</strong><br>${q.clientEmail || ''}</td>
                                <td>${q.origin || 'N/A'} â†’ ${q.destination || 'N/A'}</td>
                                <td><strong>$${(q.total || 0).toLocaleString()}</strong></td>
                                <td><span class="status-badge status-${q.status || 'pending'}">${q.status || 'Pending'}</span></td>
                                <td>${new Date(q.createdAt).toLocaleDateString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('recent-quotes-content').innerHTML = html;
        }

        function renderAllQuotes() {
            if (allQuotes.length === 0) {
                document.getElementById('all-quotes-content').innerHTML = `
                    <div class="empty-state">
                        <p>No quotes yet. Create your first moving quote!</p>
                    </div>
                `;
                return;
            }

            const html = `
                <table class="quotes-table">
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Origin â†’ Destination</th>
                            <th>Details</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allQuotes.map(q => `
                            <tr>
                                <td><strong>${q.clientName || 'N/A'}</strong><br>${q.clientEmail || ''}</td>
                                <td>${q.origin || 'N/A'} â†’ ${q.destination || 'N/A'}</td>
                                <td>${q.movers || 0} movers, ${q.hours || 0} hours<br>${q.moveType || 'local'}, ${q.truckSize || 'medium'} truck</td>
                                <td><strong>$${(q.total || 0).toLocaleString()}</strong></td>
                                <td><span class="status-badge status-${q.status || 'pending'}">${q.status || 'Pending'}</span></td>
                                <td>${new Date(q.createdAt).toLocaleDateString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('all-quotes-content').innerHTML = html;
        }

        // ============================================
        // CREATE QUOTE
        // ============================================
        document.getElementById('quote-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('mq_token');
            
            // Gather form data
            const formData = {
                clientName: document.getElementById('client-name').value,
                clientEmail: document.getElementById('client-email').value,
                origin: document.getElementById('origin').value,
                destination: document.getElementById('destination').value,
                moveType: document.getElementById('move-type').value,
                homeSize: document.getElementById('home-size').value,
                movers: parseInt(document.getElementById('movers').value),
                hours: parseInt(document.getElementById('hours').value),
                truckSize: document.getElementById('truck-size').value,
                hourlyRate: parseFloat(document.getElementById('hourly-rate').value),
                packing: document.getElementById('packing').checked,
                storage: document.getElementById('storage').checked,
                notes: document.getElementById('notes').value
            };

            // Calculate total
            const hourlyRate = formData.hourlyRate || 100;
            let total = formData.movers * formData.hours * hourlyRate;
            
            const truckMultiplier = {
                'small': 1.0,
                'medium': 1.2,
                'large': 1.4
            };
            total *= truckMultiplier[formData.truckSize] || 1.0;
            
            if (formData.packing) total += 200;
            if (formData.storage) total += 150;
            if (formData.moveType === 'longdistance') total *= 1.5;
            
            formData.total = Math.round(total);

            try {
                const response = await fetch(`${API_URL}/api/quotes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to create quote');
                }

                showToast('Quote created successfully!', 'success');
                resetForm();
                await loadQuotes();
                
                // Scroll to quotes list
                setTimeout(() => {
                    document.querySelector('.quotes-list').scrollIntoView({ behavior: 'smooth' });
                }, 500);
            } catch (error) {
                console.error('Create quote error:', error);
                showToast(error.message || 'Failed to create quote', 'error');
            }
        });

        function resetForm() {
            document.getElementById('quote-form').reset();
        }

        function scrollToQuoteForm() {
            document.getElementById('quote-form-section').scrollIntoView({ behavior: 'smooth' });
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function switchView(viewName) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Switch views
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('view-' + viewName).classList.add('active');
        }

        function showUpgradeModal() {
            alert('Upgrade to Pro for $29/month!\n\nâœ“ Unlimited quotes\nâœ“ Custom branding\nâœ“ Email quotes to clients\nâœ“ Priority support\n\nContact support@movequote.com to upgrade.');
        }

        function logout() {
            localStorage.removeItem('mq_token');
            localStorage.removeItem('mq_user');
            window.location.href = 'auth.html';
        }

        // ============================================
        // TOAST
        // ============================================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // ============================================
        // START
        // ============================================
        init();
    </script>
</body>
</html>
